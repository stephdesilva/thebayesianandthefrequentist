---
title: "The Central Limit Theorem"
author: "Steph and John"
date: '2019-04-04'
slug: p-values
tags: p-values
categories:
- Bayes
- Frequentist
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
    keep_tex: true
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
    keep_tex: true
link-citations: yes

---



<pre class="r"><code>generate_plot_data &lt;- function(N,n_val,rdist,...)
{  
  # Initialize data for N datasets of size n
  X_mat &lt;- matrix(rdist(N*n_val, ...),N,n_val)
  
  # Calculate the means
  x_bar &lt;- apply(X_mat,1,mean)

  # Approximate the distribution of x_bar
  dens &lt;- density(x_bar)
  
  # Stores the data
  dat1 &lt;- cbind(x=dens$x,y=dens$y, n_val)
  colnames(dat1) &lt;- c(&quot;x&quot;,&quot;y&quot;,&quot;n_val&quot;)
  
  # Approximate the mean and variance of the distribution
  mu &lt;- mean(X_mat)
  sigma2 &lt;- var(as.vector(X_mat))
  
  # Calculate the parameters of the CLT distribution
  mu_CLT     &lt;- mu
  sigma2_CLT &lt;- sigma2/n_val
  sigma_CLT  &lt;- sqrt(sigma2_CLT)
  
  # 
  xg &lt;- seq(mu_CLT - 5*sigma_CLT,mu_CLT + 5*sigma_CLT,,1000)
  fg &lt;- dnorm(xg,mu_CLT,sigma_CLT)
  dat2 &lt;- cbind(xg,fg,n_val)
  colnames(dat2) &lt;- c(&quot;x&quot;,&quot;y&quot;,&quot;n_val&quot;)

  tib1 &lt;- as_tibble(dat1)
  tib2 &lt;- as_tibble(dat2)
  tib1 &lt;- tib1 %&gt;% add_column(method=&quot;exact&quot;)
  tib2 &lt;- tib2 %&gt;% add_column(method=&quot;CLT&quot;)
  tib &lt;- bind_rows(tib1,tib2)
  
  return(tib)
}</code></pre>
<pre class="r"><code>vn &lt;- seq(1,50, by=1)
tib_comb &lt;- c()
for (i in 1:length(vn)) 
{
  tib_bit &lt;- generate_plot_data(N=100000, 
                                n=vn[i], 
                                rweibull, 
                                shape=k, scale=lambda) %&gt;% 
                        add_column(dist=&quot;weibull&quot;)
  tib_comb &lt;- bind_rows(tib_comb,tib_bit)
  
  
  tib_bit &lt;- generate_plot_data(N=100000, 
                                n=vn[i], 
                                rt, 
                                df=2) %&gt;% 
                        add_column(dist=&quot;t(df=2)&quot;)  
  tib_comb &lt;- bind_rows(tib_comb,tib_bit)
  
  
  tib_bit &lt;- generate_plot_data(N=100000, 
                                n=vn[i], 
                                rchisq, 
                                df=2) %&gt;% 
                        add_column(dist=&quot;chi-squared(df=2)&quot;)  
  tib_comb &lt;- bind_rows(tib_comb,tib_bit)
  
  
  tib_bit &lt;- generate_plot_data(N=100000, 
                                n=vn[i], 
                                rt, 
                                df=1) %&gt;% 
                        add_column(dist=&quot;Cauchy&quot;)  
  tib_comb &lt;- bind_rows(tib_comb,tib_bit)  
  

  tib_bit &lt;- generate_plot_data(N=100000, 
                                n=vn[i], 
                                rt, 
                                df=4) %&gt;% 
                        add_column(dist=&quot;t(df=4)&quot;)  
  tib_comb &lt;- bind_rows(tib_comb,tib_bit)    
  
  rbimod &lt;- function(n) {
    y &lt;- rbinom(n,1,0.5)
    x &lt;- y*rnorm(n,mean=2) + (1-y)*rnorm(n,mean=-2)
  }
  
  tib_bit &lt;- generate_plot_data(N=100000, 
                                n=vn[i], 
                                rbimod) %&gt;% 
                        add_column(dist=&quot;bimodal&quot;)  
  tib_comb &lt;- bind_rows(tib_comb,tib_bit)  
}
save(tib_comb,&quot;clt.Rdata&quot;)</code></pre>
<pre class="r"><code>library(gganimate)

tib_use &lt;- tib_comb %&gt;% filter(dist==&quot;Cauchy&quot;)
g1 &lt;- ggplot(tib_use,aes(x=x,y=y,color=method)) +
  geom_line(size=1.5) +
  theme_bw(base_size = 22) + 
  theme(legend.position= c(0.8, 0.8)) +
  coord_cartesian(xlim = c(-1000,1000)) +
  labs(color=&quot;Methods&quot;,x=&#39;X bar&#39;,y=&#39;density&#39;, title = &quot;Cauchy - n: { round(frame_time) }&quot;) + 
  transition_time(time=n_val) 
g1
anim_save(&quot;clt_Cauchy.gif&quot;)

tib_use &lt;- tib_comb %&gt;% filter(dist==&quot;t(df=2)&quot;)
g2 &lt;- ggplot(tib_use,aes(x=x,y=y,color=method)) +
  geom_line(size=1.5) +
  theme_bw(base_size = 22) + 
  theme(legend.position= c(0.8, 0.8)) +
  coord_cartesian(xlim = c(-50,50)) +
  labs(color=&quot;Methods&quot;,x=&#39;X bar&#39;,y=&#39;density&#39;, title = &quot;t(df=2) - n: { round(frame_time) }&quot;) + 
  transition_time(time=n_val) 
g2
anim_save(&quot;clt_t2.gif&quot;)

tib_use &lt;- tib_comb %&gt;% filter(dist==&quot;chi-squared(df=2)&quot;)
g3 &lt;- ggplot(tib_use,aes(x=x,y=y,color=method)) +
  geom_line(size=1.5) +
  theme_bw(base_size = 22) + 
  theme(legend.position= c(0.8, 0.8)) +
  coord_cartesian(xlim = c(0,7)) +
  labs(color=&quot;Methods&quot;,x=&#39;X bar&#39;,y=&#39;density&#39;, title = &quot;chi-squared(df=2) - n: { round(frame_time) }&quot;) + 
  transition_time(time=n_val) 
g3
anim_save(&quot;clt_chi2.gif&quot;)

tib_use &lt;- tib_comb %&gt;% filter(dist==&quot;weibull&quot;)
g4 &lt;- ggplot(tib_use,aes(x=x,y=y,color=method)) +
  geom_line(size=1.5) +
  theme_bw(base_size = 22) + 
  theme(legend.position= c(0.8, 0.8)) +
  coord_cartesian(xlim = c(0,30)) +
  labs(color=&quot;Methods&quot;,x=&#39;X bar&#39;,y=&#39;density&#39;, title = &quot;Weibull(k=1.1,lambda=10) - n: { round(frame_time) }&quot;) + 
  transition_time(time=n_val) 
g4
anim_save(&quot;clt_weibull.gif&quot;)

tib_use &lt;- tib_comb %&gt;% filter(dist==&quot;t(df=4)&quot;)
g5 &lt;- ggplot(tib_use,aes(x=x,y=y,color=method)) +
  geom_line(size=1.5) +
  theme_bw(base_size = 22) + 
  theme(legend.position= c(0.8, 0.8)) +
  coord_cartesian(xlim = c(-10,10)) +
  labs(color=&quot;Methods&quot;,x=&#39;X bar&#39;,y=&#39;density&#39;, title = &quot;t(df=4) - n: { round(frame_time) }&quot;) + 
  transition_time(time=n_val) 
g5
anim_save(&quot;clt_t4.gif&quot;)

tib_use &lt;- tib_comb %&gt;% filter(dist==&quot;bimodal&quot;)
g6 &lt;- ggplot(tib_use,aes(x=x,y=y,color=method)) +
  geom_line(size=1.5) +
  theme_bw(base_size = 22) + 
  theme(legend.position= c(0.8, 0.8)) +
  coord_cartesian(xlim = c(-5,5)) +
  labs(color=&quot;Methods&quot;,x=&#39;X bar&#39;,y=&#39;density&#39;, title = &quot;bimodal - n: { round(frame_time) }&quot;) + 
  transition_time(time=n_val) 
g6
anim_save(&quot;clt_bimodal.gif&quot;)</code></pre>
<pre class="r"><code>library(magick)
g1_mgif &lt;- image_read(&quot;clt_Cauchy.gif&quot;)
g2_mgif &lt;- image_read(&quot;clt_t2.gif&quot;)
g3_mgif &lt;- image_read(&quot;clt_chi2.gif&quot;)
g4_mgif &lt;- image_read(&quot;clt_weibull.gif&quot;)
g5_mgif &lt;- image_read(&quot;clt_t4.gif&quot;)
g6_mgif &lt;- image_read(&quot;clt_bimodal.gif&quot;)

top_gif &lt;- image_append(c(g3_mgif[1], g4_mgif[1], g5_mgif[1]))
bot_gif &lt;- image_append(c(g2_mgif[1], g1_mgif[1], g6_mgif[1]))
new_gif &lt;- image_append(c(top_gif,bot_gif),stack=TRUE)
for(i in 2:100){
  top_gif_bit &lt;- image_append(c(g3_mgif[i], g4_mgif[i], g5_mgif[i]))
  bot_gif_bit &lt;- image_append(c(g2_mgif[i], g1_mgif[i], g6_mgif[i]))
  comb_gif &lt;- image_append(c(top_gif_bit,bot_gif_bit),stack=TRUE)
  new_gif &lt;- c(new_gif,comb_gif)
}

image_write(new_gif,&quot;two_by_three.gif&quot;)</code></pre>
<center>
<img src="two_by_three.gif" style="width:75%">
</center>
