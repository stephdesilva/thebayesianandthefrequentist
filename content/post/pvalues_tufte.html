---
title: "Let's break some p-values - Part 1"
author: "Steph and John"
date: "2019-03-18"
slug: p-values
tags: p-values
categories:
- Bayes
- Frequentist
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
    keep_tex: true
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
    keep_tex: true
bibliography: BAF.bib
link-citations: yes
---



<!--

```
## Warning: package 'RefManageR' was built under R version 3.4.4
```
-->
<div id="and-so-it-begins.." class="section level2">
<h2>And so it begins..</h2>
<p><em>Our location: an office somewhere in Sydney, Australia. It might be well-appointed corporate digs, a slightly underfunded academic building or a cheap cafe somewhere in central Sydney. Choose your own statistical adventure.</em></p>
<p><strong>John</strong>: Where do you want to start Steph?</p>
<p><strong>Steph</strong>: I don’t know, John. I have a lot of pent up rage. Let’s break something.</p>
<p><strong>John</strong>: We both know you have issues, Steph. We could take a stab at reproducibility, replicability, robustness? Even better, we could take a stab at <em>truth</em>.</p>
<p><strong>Steph</strong>: Literally?</p>
<p><strong>John</strong>: Figuratively. We planned to do something useful, remember?</p>
<p><strong>Steph</strong>: OK. But these concepts are all really complex. Explain it to me like … I’m a management consultant. There should be a powerpoint and a snappy title.</p>
<p><strong>John</strong>: No chance. I’ll explain it like I’m a professor of statistics.</p>
<p><strong>Steph</strong>: My way is funnier. You and Microsoft SmartArt. Just give me five minutes to put a bet down with your grad students.</p>
<p><strong>John</strong>: Mine way at least makes sense and has a point.</p>
<p><strong>Steph</strong>: Fair call. OK, go!</p>
<p><strong>John</strong>: Alright, it started a few years ago. People started looking into whether
particular bits of medical research were reproducible. In particular
<span class="citation">(Ioannidis <a href="#ref-Ioannidis2005">2005</a>)</span> tried to reproduce
49 famous medical publications from
1990-2003 resulting from randomized trials: 45 claimed successful
intervention.</p>
<pre><code>    * 7 (16\%) were contradicted.
    * 7 others (16\%) found effects sizes were exaggerated
    * 20 (44\%) were replicated.
    * 11 (24\%) remained largely unchallenged.
    </code></pre>
<p><strong>John</strong>: There were a number of other papers too, like <span class="citation">(Pashler and Wagenmakers <a href="#ref-PashlerWagenmakers2012">2012</a>)</span>.
The common theme between all of these papers, statistically speaking, is hypothesis testing.</p>
<p><strong>Steph</strong>: You know what this dialogue needs, John?</p>
<p><strong>John</strong>: You’re going to tell me, whether I want to hear it or not.</p>
<p><strong>Steph</strong>: Relateable examples, mate.</p>
<p><strong>John</strong> (thinks): OK so a few years ago my wife was rear-ended while driving and the
car was written off so we needed to buy a new car. While we were looking to
get a new car my sister in law asked is (as a joke) “Are you getting a red car?
I heard they’re fast!”</p>
<p><img src="lamborghini_huracan_slideshow_lead.jpg" style="width:90%"></p>
<p><strong>John</strong>: Now I don’t know much about cars at all. So if I went into a
car yard I wouldn’t want to buy one that looked like this.</p>
<p><strong>Steph</strong>: Why not?</p>
<p><strong>John</strong>: Because fast cars are also expensive cars! But that is not the point.
I wanted to look at a bunch of ways to meddle with hypothesis tests in order
to get them to break and my first example related to by sister in law’s joke.</p>
</div>
<div id="red-cars-are-faster" class="section level1">
<h1>Red cars are faster!</h1>
<p>Let us imagine a simplified world.
Suppose that</p>
<ul>
<li><p>There are only two car colours -
<span style="color:red"><strong>red</strong></span> cars and
<span style="color:blue"><strong>blue</strong></span> cars
encoded into the variable <span class="math inline">\(\mbox{colour}_i\)</span>;</p></li>
<li><p>Cars can eiher be <span style="color:purple"><strong>sports</strong></span> cars and
<span style="color:green"><strong>normal</strong></span> cars;
encoded into the variable <span class="math inline">\(\mbox{type}_i\)</span>;</p></li>
<li><p><span style="color:purple"><strong>Sports</strong></span> cars
are more likely to be <span style="color:red"><strong>red</strong></span>
than <span style="color:green"><strong>normal</strong></span> cars</p></li>
<li><p><span style="color:purple"><strong>sports</strong></span> cares
are generally faster than
<span style="color:green"><strong>normal</strong></span> cars.</p></li>
</ul>
<p>The relationship between the three variables can
be visualized by a directed acyclic graphs.
There are three nodes type, colour and speed. The car type “causes”
the car colour and the car speed so there is a directed
edge from type to colour and type to speed. We can visualize this
using the <code>dagitty</code> and <code>ggdag</code> packages <span class="citation">(Textor and van der Zander <a href="#ref-R-dagitty">2016</a>,<span class="citation">@R-ggdag</span>)</span>.</p>
<pre class="r"><code>library(dagitty)
library(ggdag)

dagified &lt;- dagify(colour ~ type,
                   speed ~ type,
                   exposure = &quot;x&quot;,
                   outcome = &quot;speed&quot;)
ggdag(dagified, layout = &quot;circle&quot;)</code></pre>
<div class="figure"><span id="fig:fig-margin1"></span>
<img src="/post/pvalues_tufte_files/figure-html/fig-margin1-1.png" alt="DAG for speed, colour and type" width="336" />
<p class="caption">
Figure 1: DAG for speed, colour and type
</p>
</div>
</div>
<div id="simulating-data" class="section level1">
<h1>Simulating data</h1>
<p>To put some probability structure on this let
sports cars and normal cars be equally likely
<span class="math display">\[
\begin{array}{rl}
{\mathbb P}( \mbox{sports car}  ) = 0.5 \\
{\mathbb P}( \mbox{normal car}  ) = 0.5 \\
\end{array}
\]</span>
and specify conditional probabilities reflecting that sports
cars are more likely to be red than normal cars via
<span class="math display">\[
\begin{array}{rl}
{\mathbb P}( \mbox{red car} | \mbox{sports car}  ) &amp; = 0.8, \\
{\mathbb P}( \mbox{blue car} | \mbox{sports car}  ) &amp; = 0.2, \\
{\mathbb P}( \mbox{red car} | \mbox{normal car}  ) &amp; = 0.2, \qquad \mbox{and} \\
{\mathbb P}( \mbox{blue car} | \mbox{normal car}  ) &amp; = 0.8. \\
\end{array}
\]</span>
Finally, suppose that cars travel on average <span class="math inline">\(\beta_0 = 100\)</span>km/h,
with sports cars travelling on average <span class="math inline">\(\beta_1 = 50km/h\)</span> higher,
with a common standard deviation of <span class="math inline">\(\sigma=50\)</span>km/h. Then we could
simulate speed of the <span class="math inline">\(i\)</span>th sample via
<span class="math display">\[
\begin{array}{rl}
\mbox{speed}_i 
&amp;  = \beta_0 + \beta_1 \times {\mathbb I}(\mbox{type}_i=\mbox{sports}) + \varepsilon_i  
\\
&amp;  = 100 + 50 \times {\mathbb I}(\mbox{type}_i=\mbox{sports}) + \varepsilon_i 
\end{array}
\]</span>
where independently <span class="math inline">\(\varepsilon_i \sim N(0,50^2)\)</span>.</p>
<pre class="marginfigure"><code>__Steph__: So you have set up a situation where the speed of the car has 
only is related to the colour of the car through a correlation between
red cars and sports cars.

__John__: Exactly, and this is going to be relevant later.</code></pre>
<p>Let’s simulate some data that captures this scenario using R <span class="citation">(R Core Team <a href="#ref-R-base">2018</a>)</span></p>
<pre class="r"><code># Specify true values
prob_sport &lt;- 0.5
prob_red_given_sport  &lt;- 0.8
prob_red_given_normal &lt;- 0.2
beta0  &lt;- 100
beta1  &lt;- 50
sd_Val &lt;- 50
n_cars &lt;- 50

# Simulate car type
type_ind &lt;- rbinom(n_cars,1,prob_sport)

# Calculate colour probs
prob_colour &lt;- ifelse(type_ind,prob_red_given_sport,prob_red_given_normal)

# Simulate car colours
colour_ind &lt;- rbinom(n_cars,1,prob_colour)

# Simulate car speeds
speed &lt;- beta0 + beta1*(type_ind==1) + rnorm(n_cars,sd=sd_Val)

# Convert to tibble and make categories readible
tib &lt;- tibble(colour_ind,
              speed) %&gt;% 
  mutate(colour=as.factor(ifelse(colour_ind==0,&quot;blue&quot;,&quot;red&quot;)))</code></pre>
<pre class="marginfigure"><code>__Steph__: Wait, wait, wait! You didn&#39;t record the car type.

__John__: So we are going to break this hypothesis test by dropping
an important variable.</code></pre>
</div>
<div id="boxplots-and-two-sample-t-tests" class="section level1">
<h1>Boxplots and Two sample t-tests</h1>
<p>Now that we have silulated some data we can some boxplots and perform
some statistical tests. If we plot a boxplot for speed against colour
we get.</p>
<pre class="r"><code>p &lt;- ggplot(tib, aes(x=colour, y=speed, fill=colour)) + 
  geom_boxplot() +
  theme_bw()
p</code></pre>
<div class="figure"><span id="fig:fig-margin2"></span>
<img src="/post/pvalues_tufte_files/figure-html/fig-margin2-1.png" alt="speed vs colour" width="336" />
<p class="caption">
Figure 2: speed vs colour
</p>
</div>
<p>So if we wanted to see if red cars were significantly faster than
blue cars we could perform a <span class="math inline">\(t\)</span> test <span class="citation">(Burk and Anton <a href="#ref-R-tadaatoolbox">2018</a>)</span>.</p>
<pre class="r"><code>library(tadaatoolbox)
tadaa_t.test(data=tib, response=speed, group=colour, print=&quot;markdown&quot;)</code></pre>
<p>Table 1: <strong>Two Sample t-test</strong> with alternative hypothesis: <span class="math inline">\(\mu_1 \neq \mu_2\)</span></p>
<table>
<thead>
<tr class="header">
<th align="center">Diff</th>
<th align="center"><span class="math inline">\(\mu_1\)</span> blue</th>
<th align="center"><span class="math inline">\(\mu_2\)</span> red</th>
<th align="center">t</th>
<th align="center">SE</th>
<th align="center">df</th>
<th align="center"><span class="math inline">\(CI_{95\%}\)</span></th>
<th align="center">p</th>
<th align="center">Cohen's d</th>
<th align="center">Power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">-47.75</td>
<td align="center">104.22</td>
<td align="center">151.96</td>
<td align="center">-3.01</td>
<td align="center">15.88</td>
<td align="center">48</td>
<td align="center">(-79.68 - -15.81)</td>
<td align="center">&lt; .01</td>
<td align="center">-0.87</td>
<td align="center">0.84</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><br></p>
<p>We get statistical significance as expected.</p>
</div>
<div id="reproducibility-prediction-and-inference" class="section level1">
<h1>Reproducibility, prediction and inference</h1>
<p>Suppose that we went to a number of “car yards” (i.e., repeated the
experiment) where data was generatedusing the above process and we
<strong>only</strong> observed</p>
<ul>
<li><p>the speed of the car and the</p></li>
<li><p>the colour of the car.</p></li>
</ul>
<p>Suppose that we
repeated the experiment 1000 times, that is we went to 1000 car yards
and performed the same two sample t-test on different collected
samples at each car yard collecting data for <span class="math inline">\(n=50\)</span> different cars
each time.</p>
<ul>
<li><p>How often would red be statistically significant?</p></li>
<li><p>Would our results be reproducible?</p></li>
</ul>
<pre class="r"><code>n_car_yards &lt;- 1000

p_values &lt;- c()
for (i in 1:n_car_yards)
{
  # Simulate car type
  type_ind &lt;- rbinom(n_cars,1,prob_sport)
  
  # Calculate colour probs
  prob_colour &lt;- ifelse(type_ind,prob_red_given_sport,prob_red_given_normal)
  
  # Simulate car colours
  colour_ind &lt;- rbinom(n_cars,1,prob_colour)
  
  # Simulate car speeds
  speed &lt;- beta0 + beta1*(type_ind==1) + rnorm(n_cars,sd=sd_Val)

  # Perform two-sample t-test
  p_values[i] &lt;- t.test(speed[colour_ind==1],speed[colour_ind==1]==0)$p.value
}</code></pre>
<p>From the above simulations we find that 100 percent
of simulations where red cars were statisticallly significantly faster than blue cars
even though the colour of the car has nothing to do with the speed of the car!</p>
<p>Then</p>
<ul>
<li><p><strong>Reproducibility</strong>: The results would be largely reproducible since
if we went from car yard to car yard red cars would be generally faster
than blue cars.
Pre-registration does not work.</p></li>
<li><p><strong>Prediction</strong>: If we were to pick a car that we wanted to be fast
then we would pick a red car and the car would be more likely to be
faster than if we picked a blue car.</p></li>
<li><p><strong>Inference</strong>: Painting our car red would not make it any faster.</p></li>
</ul>
</div>
<div id="post-example-banter" class="section level1">
<h1>Post example Banter</h1>
<p><strong>Steph</strong>: Some witty remark</p>
<p><strong>John</strong>: Ha ha that was so witty Steph.</p>
<p><br></p>
<p><br></p>
<div id="refs" class="references">
<div id="ref-R-ggdag">
<p>Barrett, Malcolm. 2018. <em>Ggdag: Analyze and Create Elegant Directed Acyclic Graphs</em>. <a href="https://CRAN.R-project.org/package=ggdag" class="uri">https://CRAN.R-project.org/package=ggdag</a>.</p>
</div>
<div id="ref-R-tadaatoolbox">
<p>Burk, Lukas, and Tobias Anton. 2018. <em>Tadaatoolbox: Helpers for Data Analysis and Presentation Focused on Undergrad Psychology</em>. <a href="https://CRAN.R-project.org/package=tadaatoolbox" class="uri">https://CRAN.R-project.org/package=tadaatoolbox</a>.</p>
</div>
<div id="ref-Ioannidis2005">
<p>Ioannidis, John P. A. 2005. “Contradicted and Initially Stronger Effects in Highly Cited Clinical Research.” <em>JAMA</em> 294 (2): 218–28.</p>
</div>
<div id="ref-PashlerWagenmakers2012">
<p>Pashler, Harold, and Eric–Jan Wagenmakers. 2012. “Editors’ Introduction to the Special Section on Replicability in Psychological Science: A Crisis of Confidence?” <em>Perspectives on Psychological Science</em> 7 (6): 528–30.</p>
</div>
<div id="ref-R-base">
<p>R Core Team. 2018. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-R-dagitty">
<p>Textor, Johannes, and Benito van der Zander. 2016. <em>Dagitty: Graphical Analysis of Structural Causal Models</em>. <a href="https://CRAN.R-project.org/package=dagitty" class="uri">https://CRAN.R-project.org/package=dagitty</a>.</p>
</div>
</div>
</div>
